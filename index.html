<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–§—ñ–ª—å–º–∏ –Ω–∞ 2025 ‚Äî React (Global Likes via Supabase)</title>
  <meta name="theme-color" content="#121212" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Material+Symbols+Rounded" rel="stylesheet">
  <style>
    :root{
      --md-surface:#121212;--md-surface-2:#1e1e1e;--md-surface-3:#232323;
      --md-on-surface:#e6e6e6;--md-on-surface-2:#cfcfcf;
      --md-primary:#8ab4f8;--md-primary-variant:#5e9bff;
      --md-outline:#303030;--radius:16px;
      --elev-1:0 6px 12px rgba(0,0,0,.35);--elev-2:0 10px 24px rgba(0,0,0,.45)
    }
    *{box-sizing:border-box}html,body,#root{height:100%}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      color:var(--md-on-surface);
      background:radial-gradient(1200px 800px at 10% -10%,#1a1a1a 0%,#121212 60%,#0e0e0e 100%)
    }
    .elevation-1{box-shadow:var(--elev-1)}.elevation-2{box-shadow:var(--elev-2)}
    .app-bar{position:sticky;top:0;z-index:8;display:flex;align-items:center;gap:12px;
      padding:12px 20px;background:var(--md-surface-2);border-bottom:1px solid var(--md-outline)}
    .app-title{font-weight:700;letter-spacing:.3px}
    .actions{margin-left:auto;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .search-wrap{display:flex;align-items:center;gap:8px;background:var(--md-surface-3);
      border:1px solid var(--md-outline);padding:8px 10px;border-radius:999px}
    .search-wrap input{background:transparent;border:0;outline:0;color:var(--md-on-surface);width:220px}
    .material-symbols-rounded{font-variation-settings:'FILL' 0,'wght' 500,'GRAD' 0,'opsz' 24}
    .md-btn{display:inline-flex;align-items:center;gap:8px;background:var(--md-primary);color:#0d1117;
      border:0;padding:10px 14px;border-radius:12px;cursor:pointer;transition:transform .06s ease,filter .2s ease;white-space:nowrap}
    .md-btn:hover{filter:brightness(1.05)}.md-btn:active{transform:translateY(1px) scale(.99)}
    .md-btn.tonal{background:#2a2f3a;color:var(--md-on-surface-2);border:1px solid var(--md-outline)}
    .md-btn.active{outline:2px solid var(--md-primary-variant)}
    .select,.input{background:var(--md-surface-3);color:var(--md-on-surface);
      border:1px solid var(--md-outline);padding:10px 12px;border-radius:12px}
    main{padding:24px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:18px}
    .card{overflow:hidden;background:var(--md-surface-2);border:1px solid var(--md-outline);
      border-radius:var(--radius);display:flex;flex-direction:column;position:relative}
    .poster-wrap{position:relative;aspect-ratio:16/9;background:#0f0f0f;overflow:hidden}
    .poster{width:100%;height:100%;object-fit:cover;display:block;transform:scale(1.02);transition:transform .35s ease}
    .card:hover .poster{transform:scale(1.06)}
    .card-body{padding:14px;display:grid;gap:12px}
    .title{margin:0;font-size:16px;line-height:1.3;font-weight:600;color:var(--md-on-surface);min-height:42px}
    .link-btn{width:100%;justify-content:center;text-decoration:none}
    .watched-toggle{position:absolute;left:10px;top:10px;display:inline-flex;align-items:center;gap:6px;
      background:rgba(20,180,120,.16);border:1px solid rgba(50,200,150,.35);color:#a4ffde;
      padding:6px 10px;border-radius:999px;cursor:pointer;backdrop-filter:blur(6px)}
    .admin-delete{position:absolute;right:10px;top:10px;display:inline-flex;align-items:center;gap:6px;
      background:rgba(200,60,60,.18);border:1px solid rgba(220,80,80,.5);color:#ffd6d6;
      padding:6px 10px;border-radius:999px;cursor:pointer;backdrop-filter:blur(6px)}
    .reactions{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .react-btn{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--md-outline);
      background:var(--md-surface-3);color:var(--md-on-surface-2);padding:6px 10px;border-radius:999px;cursor:pointer}
    .react-btn.active-like{background:rgba(50,160,255,.18);border-color:rgba(80,170,255,.5);color:#cfe1ff}
    .react-btn.active-dislike{background:rgba(255,80,80,.18);border-color:rgba(255,100,100,.55);color:#ffd6d6}
    .counts{font-size:12px;color:#aeb3bb;display:flex;gap:10px}
    .empty{grid-column:1/-1;text-align:center;color:#9aa0a6;background:var(--md-surface-2);
      border:1px dashed var(--md-outline);padding:24px;border-radius:var(--radius)}
    .footer{margin:10px 24px 28px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      border-top:1px solid var(--md-outline);padding-top:16px}
    .footer .link{margin-left:auto}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .badge{background:#273042;border:1px solid #334155;color:#cfe1ff;padding:5px 8px;border-radius:999px;font-size:12px}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:saturate(1.2) blur(2px);
      display:flex;align-items:center;justify-content:center;z-index:10;}
    .modal{width:min(640px,92vw);background:var(--md-surface-2);border:1px solid var(--md-outline);
      border-radius:20px;padding:20px 20px 16px;box-shadow:var(--elev-2);display:grid;gap:14px}
    .modal h2{margin:0 0 4px 0;font-size:20px}
    .modal .sub{color:#aeb3bb;font-size:14px}
    .hint{font-size:12px;color:#9aa0a6}
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Supabase JS v2 -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useState, useRef } = React;

    // ====== –í–°–¢–ê–í–¨ –°–í–û–Å ======
    const SUPABASE_URL = "https://kvfmvbfmkkkmoewyjtfu.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt2Zm12YmZta2trbW9ld3lqdGZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5Nzk4NTQsImV4cCI6MjA3ODU1NTg1NH0.uPBy77qj0WFdTN7h1fIcxaKAKtwWu690kkElThEbFwk";
    // =========================

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession: false }
    });

    const SHOT = url => `https://s.wordpress.com/mshots/v1/${encodeURIComponent(url)}?w=640`;
    const LS_KEY_LAST_NICK = "xmas_last_nick_v1";
    const LS_KEY_NICK_LIST = "xmas_nicks_v4";
    const LS_PREFIX_WATCHED = "xmas_watched_";
    const LS_ADMIN_HASH = "xmas_admin_hash_v1";
    const LS_MOVIES = "xmas_movies_local_v1";
    const LS_PREFIX_LOCAL_REACT = "xmas_react_local_";
    async function sha256Hex(str){
      const enc = new TextEncoder().encode(str);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return Array.from(new Uint8Array(buf)).map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    const getNickList = () => JSON.parse(localStorage.getItem(LS_KEY_NICK_LIST) || "[]");
    const setNickList = arr => localStorage.setItem(LS_KEY_NICK_LIST, JSON.stringify(arr));
    const readWatchedSet = nick => new Set(JSON.parse(localStorage.getItem(LS_PREFIX_WATCHED + nick) || "[]"));
    const saveWatchedSet = (nick, set) => localStorage.setItem(LS_PREFIX_WATCHED + nick, JSON.stringify([...set]));
    const readLocalReactions = nick => JSON.parse(localStorage.getItem(LS_PREFIX_LOCAL_REACT + nick) || "{}");
    const saveLocalReactions = (nick, obj) => localStorage.setItem(LS_PREFIX_LOCAL_REACT + nick, JSON.stringify(obj));

    const SEED = [
      { title: "–ù–∞—à –º–∞–ª–µ–Ω—å–∫–∏–π —Å–µ–∫—Ä–µ—Ç", link: "https://rezka.ag/films/comedy/75534-nash-malenkiy-sekret-2024.html" },
      { title: "–ù–µ–∑–∞–±—ã–≤–∞–µ–º–æ–µ –†–æ–∂–¥–µ—Å—Ç–≤–æ", link: "https://rezka.ag/films/comedy/52189-nezabyvaemoe-rozhdestvo-2022.html" },
      { title: "–û–¥–∏–Ω –¥–æ–º–∞ 1,2", link: "https://rezka.ag/films/comedy/833-odin-doma-1990.html" },
      { title: "–≠–ª—å—Ñ", link: "https://rezka.ag/films/fantasy/842-elf-2003.html" },
      { title: "–û—Ç–ø—É—Å–∫ –ø–æ –æ–±–º–µ–Ω—É", link: "https://rezka.ag/films/comedy/874-otpusk-po-obmenu-2006.html" },
    ];
    function loadMovies(){
      const raw = localStorage.getItem(LS_MOVIES);
      if (!raw){
        const sorted = [...SEED].sort((a,b)=>a.title.localeCompare(b.title,"ru"));
        localStorage.setItem(LS_MOVIES, JSON.stringify(sorted));
        return sorted;
      }
      try { const arr = JSON.parse(raw); return Array.isArray(arr)?arr:[...SEED]; }
      catch { return [...SEED]; }
    }
    function saveMovies(arr){ localStorage.setItem(LS_MOVIES, JSON.stringify(arr)); }

    async function linkToId(link){ return await sha256Hex(link); }

    // upsert —Ñ–∏–ª—å–º–∞ –≤ –ë–î (—á—Ç–æ–±—ã –±—ã–ª –Ω–æ—Å–∏—Ç–µ–ª—å –≥–æ–ª–æ—Å–æ–≤)
    async function ensureMovieRow(title, link){
      const id = await linkToId(link);
      await supabase.from('movies').upsert([{ id, title, link }], { onConflict: 'id' });
      return id;
    }

    // –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≥–æ–ª–æ—Å: value 1 | -1 | 0
    async function vote(link, nickname, value){
      const movie_id = await ensureMovieRow("", link);
      // —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º –≤—Å—Ç–∞–≤–∫—É, –µ—Å–ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç ‚Äî –æ–±–Ω–æ–≤–∏–º
      const { error: e1 } = await supabase.from('votes').upsert(
        [{ movie_id, nickname, value }],
        { onConflict: 'movie_id,nickname' }
      );
      if (e1) console.error(e1);
    }

    // –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≥–æ–ª–æ—Å–∞ (–∞–≥—Ä–µ–≥–∏—Ä—É–µ–º –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)
    async function fetchCounts(movieLinks){
      const ids = await Promise.all(movieLinks.map(linkToId));
      const { data, error } = await supabase.from('votes').select('movie_id,value');
      if (error){ console.error(error); return {}; }
      const map = {};
      for (const link of movieLinks) map[link] = { likes:0, dislikes:0 };
      const idToLink = {};
      movieLinks.forEach(async (l,i)=>{ idToLink[ids[i]] = l; });
      for (const row of data){
        const link = idToLink[row.movie_id];
        if (!link) continue;
        if (row.value === 1) map[link].likes++;
        if (row.value === -1) map[link].dislikes++;
      }
      return map;
    }

    // realtime –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–∞–±–ª–∏—Ü—É votes
    function subscribeVotes(onChange){
      const channel = supabase.channel('realtime-votes')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'votes' }, payload => {
          onChange(payload);
        })
        .subscribe();
      return () => { supabase.removeChannel(channel); };
    }

    function App(){
      const [nick, setNick] = useState(null);
      const [showNickModal, setShowNickModal] = useState(true);
      const [watched, setWatched] = useState(new Set());
      const [localReacts, setLocalReacts] = useState({});
      const [movies, setMovies] = useState(loadMovies);
      const [isAdmin, setIsAdmin] = useState(false);
      const [showAdminModal, setShowAdminModal] = useState(false);
      const [query, setQuery] = useState("");
      const [onlyUnwatched, setOnlyUnwatched] = useState(false);
      const [onlyLiked, setOnlyLiked] = useState(false);
      const [counts, setCounts] = useState({}); // link -> {likes,dislikes}

      const sorted = useMemo(()=>[...movies].sort((a,b)=>a.title.localeCompare(b.title,"ru")), [movies]);
      const filtered = useMemo(()=>{
        const q = query.trim().toLowerCase();
        return sorted
          .filter(i => !q || i.title.toLowerCase().includes(q))
          .filter(i => !onlyUnwatched || !watched.has(i.link))
          .filter(i => !onlyLiked || (counts[i.link]?.likes||0) > 0);
      }, [sorted, query, onlyUnwatched, onlyLiked, watched, counts]);

      useEffect(()=>{ (async()=>{
        const map = await fetchCounts(movies.map(m=>m.link));
        setCounts(map);
      })(); }, [movies]);

      useEffect(()=>{ if(nick) saveWatchedSet(nick, watched); }, [nick, watched]);
      useEffect(()=>{ if(nick) saveLocalReactions(nick, localReacts); }, [nick, localReacts]);

      useEffect(()=>{
        const unsub = subscribeVotes(async ()=>{
          const map = await fetchCounts(movies.map(m=>m.link));
          setCounts(map);
        });
        return unsub;
      }, [movies]);

      function startWithNick(inputNick){
        const n = (inputNick||"").trim();
        if(!n){ alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º"); return; }
        const list = new Set(getNickList()); list.add(n); setNickList([...list]);
        setNick(n);
        setWatched(readWatchedSet(n));
        setLocalReactions(readLocalReactions(n));
        localStorage.setItem(LS_KEY_LAST_NICK, n);
        setShowNickModal(false);
      }
      function readLocalReactions(nick){ try{return JSON.parse(localStorage.getItem(LS_PREFIX_LOCAL_REACT + nick) || "{}");}catch{return{}} }
      function logoutNick(){ setNick(null); setWatched(new Set()); setLocalReacts({}); setShowNickModal(true); }

      function toggleWatch(link){
        setWatched(prev => {
          const next = new Set(prev);
          next.has(link) ? next.delete(link) : next.add(link);
          return next;
        });
      }

      async function react(link, val){ // val 1|-1 (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ —Å–Ω–∏–º–∞–µ—Ç)
        if(!nick){ alert("–°–Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏ –Ω–∏–∫"); return; }
        const curr = localReacts[link] || 0;
        const nextVal = (curr === val) ? 0 : val;
        try{
          await ensureMovieRow("", link);
          await vote(link, nick, nextVal);
          setLocalReacts(prev => {
            const n = {...prev}; if (nextVal===0) delete n[link]; else n[link]=nextVal; return n;
          });
          // counts –ø–æ–¥—Ç—è–Ω—É—Ç—Å—è —á–µ—Ä–µ–∑ realtime ‚Üí fetchCounts
        }catch(e){ console.error(e); alert("–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è"); }
      }

      function addMovie(title, link){
        const t = (title||"").trim(); let l = (link||"").trim();
        if(!t || !l){ alert("–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫—É"); return false; }
        if(!/^https?:\/\//i.test(l)) l = "https://" + l;
        if (movies.some(m => m.link === l)) { alert("–¢–∞–∫–æ–π —Ñ–∏–ª—å–º —É–∂–µ –µ—Å—Ç—å"); return false; }
        const next = [...movies, { title: t, link: l }];
        saveMovies(next); setMovies(next);
        // —Å–æ–∑–¥–∞–¥–∏–º —Å—Ç—Ä–æ–∫—É –≤ –ë–î (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è)
        ensureMovieRow(t, l).catch(()=>{});
        return true;
      }
      function removeMovie(link){
        if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ñ–∏–ª—å–º?")) return;
        const next = movies.filter(m => m.link !== link);
        saveMovies(next); setMovies(next);
        setWatched(prev => { const s=new Set(prev); s.delete(link); return s; });
        setLocalReacts(prev => { const r={...prev}; delete r[link]; return r; });
        // –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –≥–æ–ª–æ—Å–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î (–∏—Å—Ç–æ—Ä–∏—è)
      }

      return (
        <>
          {showNickModal && (
            <NicknameModal
              defaultNick={localStorage.getItem(LS_KEY_LAST_NICK) || ""}
              onConfirm={startWithNick}
              knownNicks={getNickList()}
            />
          )}

          {showAdminModal && (
            <AdminAuthModal
              onClose={() => setShowAdminModal(false)}
              onAuthed={() => { setIsAdmin(true); setShowAdminModal(false); }}
            />
          )}

          <header className="app-bar elevation-2" aria-hidden={showNickModal}>
            <div className="app-title">üéÑ –§—ñ–ª—å–º–∏ –Ω–∞ 2025 ‚Äî React</div>

            <button className={"md-btn" + (onlyUnwatched ? " active" : "")} onClick={()=>setOnlyUnwatched(v=>!v)}>
              <span className="material-symbols-rounded">{onlyUnwatched ? "visibility" : "visibility_off"}</span>
              <span className="btn-text">{onlyUnwatched ? "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ" : "–¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ"}</span>
            </button>

            <button className={"md-btn" + (onlyLiked ? " active" : "")} onClick={()=>setOnlyLiked(v=>!v)}>
              <span className="material-symbols-rounded">thumb_up</span>
              <span className="btn-text">{onlyLiked ? "–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ" : "–¢–æ–ª—å–∫–æ —Å –ª–∞–π–∫–∞–º–∏"}</span>
            </button>

            <div className="actions">
              <div className="search-wrap">
                <span className="material-symbols-rounded">search</span>
                <input value={query} onChange={e=>setQuery(e.target.value)} type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é‚Ä¶" autoComplete="off" />
              </div>

              <span className="badge" title="–¢–µ–∫—É—â–∏–π –Ω–∏–∫">{nick ?? "‚Äî"}</span>
              <button className="md-btn tonal" onClick={logoutNick}><span className="material-symbols-rounded">person</span><span>–°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</span></button>

              {!isAdmin ? (
                <button className="md-btn" onClick={()=>setShowAdminModal(true)}><span className="material-symbols-rounded">key</span><span>–ê–¥–º–∏–Ω</span></button>
              ) : (
                <button className="md-btn tonal" onClick={()=>setIsAdmin(false)}><span className="material-symbols-rounded">logout</span><span>–ê–¥–º–∏–Ω: –≤—ã—Ö–æ–¥</span></button>
              )}
            </div>
          </header>

          {isAdmin && (<AdminPanel onAdd={addMovie} total={movies.length} />)}

          <main aria-hidden={showNickModal}>
            <div className="grid">
              {filtered.length === 0 && <div className="empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>}
              {filtered.map(item => {
                const isWatched = watched.has(item.link);
                const r = localReacts[item.link] || 0;
                const c = counts[item.link] || {likes:0, dislikes:0};
                return (
                  <article key={item.link} className={"card elevation-1" + (isWatched ? " is-watched" : "")}>
                    <div className="poster-wrap">
                      <img className="poster" loading="lazy" alt={item.title}
                           src={SHOT(item.link)}
                           onError={(e)=>{
                             const svg = encodeURIComponent(
                              `<svg xmlns='http://www.w3.org/2000/svg' width='640' height='360'>
                                <rect width='100%' height='100%' fill='#1f1f1f'/>
                                <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle'
                                  font-family='Inter, system-ui' font-size='28' fill='#9aa0a6'>${item.title}</text>
                               </svg>`);
                             e.currentTarget.src = `data:image/svg+xml;charset=utf-8,${svg}`;
                           }}/>
                      <button className="watched-toggle" onClick={()=>toggleWatch(item.link)}>
                        <span className="material-symbols-rounded">check_circle</span><span>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ</span>
                      </button>
                      {isAdmin && (
                        <button className="admin-delete" onClick={()=>removeMovie(item.link)}>
                          <span className="material-symbols-rounded">delete</span><span>–£–¥–∞–ª–∏—Ç—å</span>
                        </button>
                      )}
                    </div>
                    <div className="card-body">
                      <h3 className="title">{item.title}</h3>
                      <div className="reactions">
                        <div style={{display:"flex",gap:"8px"}}>
                          <button className={"react-btn " + (r===1 ? "active-like" : "")} onClick={()=>react(item.link, 1)}>
                            <span className="material-symbols-rounded">thumb_up</span><span>–ù—Ä–∞–≤–∏—Ç—Å—è</span>
                          </button>
                          <button className={"react-btn " + (r===-1 ? "active-dislike" : "")} onClick={()=>react(item.link, -1)}>
                            <span className="material-symbols-rounded">thumb_down</span><span>–ù–µ –Ω—Ä–∞–≤–∏—Ç—Å—è</span>
                          </button>
                        </div>
                        <div className="counts"><span>üëç {c.likes}</span><span>üëé {c.dislikes}</span></div>
                      </div>
                      <a className="md-btn link-btn" href={item.link} target="_blank" rel="noopener">
                        <span className="material-symbols-rounded">open_in_new</span><span>–°–º–æ—Ç—Ä–µ—Ç—å</span>
                      </a>
                    </div>
                  </article>
                );
              })}
            </div>
          </main>

          <footer className="footer" aria-hidden={showNickModal}>
            <button className="md-btn tonal" onClick={()=>setWatched(new Set(sorted.map(m=>m.link)))}>
              <span className="material-symbols-rounded">done_all</span><span>–û—Ç–º–µ—Ç–∏—Ç—å –≤—Å—ë –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–º</span>
            </button>
            <button className="md-btn tonal" onClick={()=>setWatched(new Set())}>
              <span className="material-symbols-rounded">restart_alt</span><span>–°–±—Ä–æ—Å–∏—Ç—å –æ—Ç–º–µ—Ç–∫–∏</span>
            </button>
            <a className="link" href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages ‚ûú</a>
          </footer>
        </>
      );
    }

    function NicknameModal({ defaultNick, onConfirm, knownNicks }){
      const [value, setValue] = useState(defaultNick || "");
      function submit(e){ e?.preventDefault(); onConfirm(value); }
      return (
        <div className="modal-backdrop" role="dialog" aria-modal="true">
          <form className="modal elevation-2" onSubmit={submit}>
            <h2>–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º</h2>
            <div className="sub">–ù–∏–∫ –ª–æ–∫–∞–ª–µ–Ω –¥–ª—è –æ—Ç–º–µ—Ç–æ–∫ ¬´–ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ¬ª. –õ–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–µ (Supabase).</div>
            <div className="row">
              <input className="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Denis" value={value} onChange={e=>setValue(e.target.value)} autoFocus />
              <button type="submit" className="md-btn"><span className="material-symbols-rounded">login</span><span>–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</span></button>
            </div>
            {knownNicks?.length>0 && (
              <div className="hint">–†–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏:{" "}
                {knownNicks.map((n,i)=>(
                  <a key={n} href="#" className="link" onClick={(e)=>{e.preventDefault(); setValue(n);}}>
                    {n}{i<knownNicks.length-1?", ":""}
                  </a>
                ))}
              </div>
            )}
          </form>
        </div>
      );
    }

    function AdminAuthModal({ onClose, onAuthed }){
      const [exists, setExists] = useState(!!localStorage.getItem(LS_ADMIN_HASH));
      const [p1, setP1] = useState(""), [p2, setP2] = useState(""), [pin, setPin] = useState("");
      const [err, setErr] = useState("");
      async function createPassword(e){
        e.preventDefault(); setErr("");
        if(!p1 || p1.length<4){ setErr("–ú–∏–Ω–∏–º—É–º 4 —Å–∏–º–≤–æ–ª–∞"); return; }
        if(p1 !== p2){ setErr("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç"); return; }
        const h = await sha256Hex(p1); localStorage.setItem(LS_ADMIN_HASH, h); onAuthed();
      }
      async function login(e){
        e.preventDefault(); setErr("");
        const h = await sha256Hex(pin);
        if (h === localStorage.getItem(LS_ADMIN_HASH)) onAuthed(); else setErr("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å");
      }
      return (
        <div className="modal-backdrop" role="dialog" aria-modal="true" onKeyDown={(e)=>{ if(e.key==="Escape") onClose(); }}>
          {!exists ? (
            <form className="modal elevation-2" onSubmit={createPassword}>
              <h2>–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
              <div className="sub">–ü–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ (SHA-256 —Ö—ç—à).</div>
              <input className="input" type="password" placeholder="–ü–∞—Ä–æ–ª—å" value={p1} onChange={e=>setP1(e.target.value)} />
              <input className="input" type="password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" value={p2} onChange={e=>setP2(e.target.value)} />
              {err && <div className="hint" style={{color:"#ffb4b4"}}>{err}</div>}
              <div className="row">
                <button type="button" className="md-btn tonal" onClick={onClose}><span className="material-symbols-rounded">close</span><span>–û—Ç–º–µ–Ω–∞</span></button>
                <button type="submit" className="md-btn"><span className="material-symbols-rounded">check</span><span>–°–æ–∑–¥–∞—Ç—å</span></button>
              </div>
            </form>
          ) : (
            <form className="modal elevation-2" onSubmit={login}>
              <h2>–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
              <input className="input" type="password" placeholder="–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞" value={pin} onChange={e=>setPin(e.target.value)} autoFocus />
              {err && <div className="hint" style={{color:"#ffb4b4"}}>{err}</div>}
              <div className="row">
                <button type="button" className="md-btn tonal" onClick={onClose}><span className="material-symbols-rounded">close</span><span>–û—Ç–º–µ–Ω–∞</span></button>
                <button type="submit" className="md-btn"><span className="material-symbols-rounded">login</span><span>–í–æ–π—Ç–∏</span></button>
              </div>
            </form>
          )}
        </div>
      );
    }

    function AdminPanel({ onAdd, total }){
      const [title, setTitle] = useState(""), [link, setLink] = useState("");
      function submit(e){ e.preventDefault(); if(onAdd(title, link)){ setTitle(""); setLink(""); } }
      return (
        <section className="elevation-1" style={{padding:"16px 24px",borderBottom:"1px solid var(--md-outline)",background:"var(--md-surface-2)"}}>
          <div className="row" style={{justifyContent:"space-between",alignItems:"center",marginBottom:"10px"}}>
            <div style={{fontWeight:700}}>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <div className="badge">–§–∏–ª—å–º–æ–≤: {total}</div>
          </div>
          <form className="row" onSubmit={submit}>
            <input className="input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" value={title} onChange={e=>setTitle(e.target.value)} style={{minWidth:"280px"}} />
            <input className="input" placeholder="–°—Å—ã–ª–∫–∞ (https://‚Ä¶)" value={link} onChange={e=>setLink(e.target.value)} style={{minWidth:"320px"}} />
            <button type="submit" className="md-btn"><span className="material-symbols-rounded">add</span><span>–î–æ–±–∞–≤–∏—Ç—å</span></button>
          </form>
          <div className="hint" style={{marginTop:"8px"}}>–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º–æ–≤ –ª–æ–∫–∞–ª—å–Ω—ã. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏ ‚Äî –≤ Supabase –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –¥–ª—è –ª—é–±–æ–π —Å—Å—ã–ª–∫–∏.</div>
        </section>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
